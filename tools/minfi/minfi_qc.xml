<tool id="minfi_qc" name="Minfi QC" version="@MINFI_VERSION@">
    <description>provides a simple quality control matrix and plot</description>
    <macros>
        <import>macros.xml</import>
    </macros>
     <expand macro="requirements" />
    <command detect_errors="exit_code">
    <![CDATA[
        Rscript '$read_qc_script'
     ]]>
    </command>
    <configfiles>
        <configfile name="read_qc_script">
    <![CDATA[
require("minfi", quietly = TRUE)

MSet <- get(load('$MethylSet'))

qc <- getQC(MSet)

write.table(qc, '$qctab')

png('$qcpng')
plotQC(qc)
dev.off()
    ]]>
        </configfile>
    </configfiles>
    <inputs>
        <param type="data" name="MethylSet" format="rdata" label="MethylSet"
            help="This class holds preprocessed data for Illumina methylation microarrays, mapped to a genomic location."/>
    </inputs>
    <outputs>
        <data name="qctab" format="txt" label="Quality Control Report"/>
        <data name="qcpng" format="png" label="Quality Control Plot"/>
    </outputs>
    <tests>
        <test>
            <param name="MethylSet" value="MethylSet.rdata"/>
            <output name="qctab" file="Quality_Control_Report.txt"/>
            <output name="qcpng" file="Quality_Control_Plot.png" compare="sim_size"/>
        </test>
    </tests>
    <help><![CDATA[
**What it does**

Minfi QC estimate sample-specific quality control (QC) for methylation data.

**Input information**

Input data is MethylSet class R object (i.e. generated by Minfi Mset Tool) holding preprocessed data for Illumina methylation microarrays, mapped to a genomic location.

**Output information**

There are two files returning from the quality control, report and plot representing the log median intensity in both the methylated (M) and unmethylated (U) channels.
When plotting these two medians against each other the good samples cluster together, while failed samples tend to separate and have lower median intensities.

    ]]></help>
    <expand macro="citations" />
</tool>
