<tool id="minfi_ppquantile" name="Minfi Preprocess Quantile" version="@MINFI_VERSION@">
    <description>implements stratified quantile normalization preprocessing</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements">
        <requirement type="package" version="0.6.0">bioconductor-illuminahumanmethylation450kanno.ilmn12.hg19</requirement>
    </expand>
    <command detect_errors="exit_code">
    <![CDATA[
     Rscript '$minfi_pp_script'
    ]]>
    </command>
    <configfiles>
        <configfile name="minfi_pp_script"><![CDATA[
require("minfi", quietly = TRUE)
RGSet <- get(load('$rgset'))

GRSet <- preprocessQuantile(RGSet, fixOutliers = TRUE,
  removeBadSamples = TRUE, badSampleCutoff = 10.5,
  quantileNormalize = TRUE, stratified = TRUE, 
  mergeManifest = FALSE, sex = NULL)

save(GRSet,file = '$grset')

]]> 
        </configfile>
    </configfiles>
    <inputs>
        <param type="data" name="rgset" format="rdata" label="RGChannelSet"
            help="These classes represents raw (unprocessed) data from a two color micro array; specifically an Illumina methylation array." />
    </inputs>
    <outputs>
        <data name="grset" format="rdata" label="GenomicRatioSet"/>
    </outputs>
    <tests>
        <test>
            <param name="rgset" value="RGChannelSet.rdata"/>
            <output name="grset" file="QuantileGenomicRatioSet.rdata"/>
        </test>
    </tests>
    <help><![CDATA[
**What it does**
 
Minfi Preprocess Quantile is implementing stratified quantile normalization preprocessing for Illumina methylation microarrays, stratified probes by region (CpG island, shore, etc.).
The normalization procedure is applied to the Meth and Unmeth intensities separately. The distribution of type I and type II signals is forced to be the same by first quantile normalizing 
the type II probes across samples and then interpolating a reference distribution to which it normalize the type I probes. 
Since probe types and probe regions are confounded and DNAm distributions vary across regions the probes are stratified by region before applying this interpolation.

**Input information**

Input data is RGChannelSet class R object (i.e. generated by Minfi Read 450k Tool) holding raw (unprocessed) data from an Illumina methylation array.

**Output information**

Minfi Preprocess Quantile returns the GenomicRatioSet class R object holding preprocessed data for Illumina methylation microarrays, mapped to a genomic location
which can be used by i.e. Minfi DMP and DMR Tools to find diffrentialy methylated regions and positions.

    ]]></help>
    <expand macro="citations" />
</tool>
